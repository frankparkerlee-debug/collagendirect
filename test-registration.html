<!DOCTYPE html>
<html>
<head>
  <title>Registration Test</title>
  <style>
    body { font-family: monospace; padding: 20px; }
    #output { background: #f5f5f5; padding: 20px; margin-top: 20px; white-space: pre-wrap; }
    .error { color: red; }
    .success { color: green; }
  </style>
</head>
<body>
  <h1>Registration API Test</h1>
  <button onclick="testRegistration()">Test Registration</button>
  <div id="output"></div>

  <script>
    async function testRegistration() {
      const output = document.getElementById('output');
      output.innerHTML = 'Testing...\n';

      try {
        // Get CSRF token
        output.innerHTML += 'Getting CSRF token...\n';
        const csrfRes = await fetch('/api/csrf.php', { credentials: 'include' });
        const csrfData = await csrfRes.json();
        output.innerHTML += 'CSRF Token: ' + csrfData.csrfToken + '\n\n';

        // Test registration
        output.innerHTML += 'Submitting registration...\n';
        const payload = {
          userType: 'practice_admin',
          email: 'test@example.com',
          password: 'password123',
          firstName: 'Test',
          lastName: 'User',
          npi: '1234567893',
          license: 'MD12345',
          licenseState: 'CA',
          licenseExpiry: '2025-12-31',
          practiceName: 'Test Practice',
          address: '123 Main St',
          city: 'Los Angeles',
          state: 'CA',
          zip: '90001',
          phone: '5555551234',
          agreeMSA: true,
          agreeBAA: true,
          signName: 'Test User',
          signTitle: 'MD',
          signDate: '2024-10-24'
        };

        const res = await fetch('/api/register.php', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'x-csrf-token': csrfData.csrfToken
          },
          credentials: 'include',
          body: JSON.stringify(payload)
        });

        const data = await res.json();
        output.innerHTML += '\n=== RESPONSE ===\n';
        output.innerHTML += 'Status: ' + res.status + '\n';
        output.innerHTML += 'Data: ' + JSON.stringify(data, null, 2) + '\n';

        if (res.status === 201) {
          output.innerHTML += '\n<span class="success">✓ SUCCESS!</span>';
        } else {
          output.innerHTML += '\n<span class="error">✗ ERROR</span>';
        }
      } catch (err) {
        output.innerHTML += '\n<span class="error">Exception: ' + err.message + '</span>';
      }
    }
  </script>
</body>
</html>
